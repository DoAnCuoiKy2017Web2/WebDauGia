@using WebDauGia.Models;

@{
    ViewBag.Title = "Add Product";
    //Layout = "~/Views/Shared/_LayoutRegisterLogin.cshtml";
}
@section view_title{
    Thêm sản phẩm
}

@section css{
@*<link rel="stylesheet" href="assets/css/bootstrap.min.css" />*@
@*<link rel="stylesheet" href="assets/font-awesome/4.5.0/css/font-awesome.min.css" />*@

<!-- page specific plugin styles -->
@*<link rel="stylesheet" href="assets/css/jquery-ui.custom.min.css" />
<link rel="stylesheet" href="assets/css/jquery.gritter.min.css" />
<link rel="stylesheet" href="assets/css/select2.min.css" />*@

@*<link rel="stylesheet" href="assets/css/bootstrap-editable.min.css" />
<link rel="stylesheet" href="assets/css/fonts.googleapis.com.css" />
<link rel="stylesheet" href="assets/css/ace.min.css" class="ace-main-stylesheet" id="main-ace-style" />
<link rel="stylesheet" href="assets/css/ace-part2.min.css" class="ace-main-stylesheet" />
<link rel="stylesheet" href="assets/css/ace-skins.min.css" />
<link rel="stylesheet" href="assets/css/ace-rtl.min.css" />
<link rel="stylesheet" href="assets/css/ace-ie.min.css" />*@

    <link href="~/bootstrap-3.3.7-dist/css/bootstrap.css" rel="stylesheet" />
    <link rel="stylesheet" href="~/Content/bootstrap-datetimepicker.css" />
    @*<link href="~/Content/DatePicker/css/bootstrap-datepicker.min.css" rel="stylesheet" />*@
}
@section js{
@*<script src="assets/js/html5shiv.min.js"></script>
<script src="assets/js/respond.min.js"></script>
<script src="assets/js/ace-extra.min.js"></script>*@

    @*<script src="//cdn.ckeditor.com/4.6.2/full/ckeditor.js"></script>*@
    @*<script src="~/Content/DatePicker/js/bootstrap-datepicker.min.js"></script>*@
    <script src="~/Content/ckeditor_4.6.2_full/ckeditor/ckeditor.js"></script>
    <script src="~/Content/Jquery-Valid/jquery.validate.min.js"></script>
    <script src="~/Content/bootstrap.file-input.js"></script>


    <script type="text/javascript" src="~/scripts/jquery.min.js"></script>
    <script type="text/javascript" src="~/scripts/moment.min.js"></script>
    <script type="text/javascript" src="~/scripts/bootstrap.min.js"></script>
    <script type="text/javascript" src="~/scripts/bootstrap-datetimepicker.js"></script>

    <script>
        $('input[type=file]').bootstrapFileInput();

        CKEDITOR.replace('FullDes', {
            toolbar: [
                ['Font', 'FontSize', '-', 'Bold', 'Italic', 'Underline', 'StrikeThrough', '-', 'Undo', 'Redo', '-', 'Cut', 'Copy', 'Paste', 'Find', 'Replace', '-', 'Outdent', 'Indent', '-', 'Print'],
                '/',
                ['NumberedList', 'BulletedList', '-', 'JustifyLeft', 'JustifyCenter', 'JustifyRight', 'JustifyBlock'],
                ['Image', 'Table', '-', 'Link', 'Flash', 'Smiley', 'TextColor', 'BGColor', 'Source']
            ]
        });
    </script>

    <script type="text/javascript">
        $('.datepicker').datepicker({
            format: 'd/mm/yyyy',
            autoclose: true,
        });
        $("#Form-Add").validate({
            rules: {
                ProName: {
                    required: true,
                },
                Price: {
                    required: true,
                },
                Quantity: {
                    required: true,
                },
            },
            messages: {
                ProName: {
                    required: "Chỗ này không được để trống.",
                },
                Price: {
                    required: "Chỗ này không được để trống.",
                },
                Quantity: {
                    required: "Chỗ này không được để trống.",
                },
            },
            errorelement: 'span',
            errorClass: 'help-block',
            highlight: function (element, errorClass, validClass) {
                $(element).addClass(errorClass).removeClass(validClass);
                $(element).closest('.form-group')
                  .addClass('has-error');
            },
            //unhighlight: function (element, errorClass, validClass) {
            //    $(element).removeClass(errorClass).addClass(validClass);
            //    $(element).closest('.form-group')
            //      .removeClass('has-error');
            //},
            success: function (label) {
                $(label).closest('.form-group')
                  .removeClass('has-error').addClass('has-success');
                label.remove;
            }

        });
    </script>

}
<form class="form-horizontal" action="" method="post" id="Form-Add" enctype="multipart/form-data">
    @*<h1 style="text-align:center">Thêm sản phẩm</h1>*@
    <div class="form-group">
        
        <div class="col-sm-4">
            <label for="ProName" class="col-sm-4 control-label">Ảnh đại diện:</label>
            <input type="file" id="fuMain" name="fuMain" />
            @*<div class="col-xs-12">
                <div id="user-profile-1" class="user-profile row">
                    <div class="col-xs-12 col-sm-3 center">
                        <div>
                            <span class="profile-picture">
                                <img id="avatar" class="editable img-responsive" alt="Alex's Avatar" src="assets/images/avatars/profile-pic.jpg" />
                            </span>
                        </div>

                    </div>
                </div>
            </div>*@
        </div>
        <div class="col-sm-4">
            <label for="ProName" class="col-sm-4 control-label">Ảnh chi tiết:</label>
            <input type="file" id="fuThumbs_1" name="fuThumbs_1" />
        </div>
        <div class="col-sm-4">
            <label for="ProName" class="col-sm-4 control-label">Ảnh chi tiết:</label>
            <input type="file" id="fuThumbs_2" name="fuThumbs_2" />
        </div>
        
    </div>
    <div class="form-group">
        <label for="ProName" class="col-sm-2 control-label">Tên sản phẩm:</label>
        <div class="col-sm-4">
            <input type="text" class="form-control" name="ProName" />
        </div>
        <label for="CatId" class="col-sm-2 control-label">Danh mục:</label>
        <div class="col-sm-4">
            <select name="CatId" class="form-control">
                @foreach (var c in @ViewBag.DanhSachDanhMuc)
                {
                    <option value="@c.CatID">@c.CatName</option>
                }
            </select>
        </div>
    </div>
    <div class="form-group">
        <label for="Quantity" class="col-sm-2 control-label">Số lượng:</label>
        <div class="col-sm-1">
            <input type="number" class="form-control" name="Quantity" />
        </div>
        <label for="Price" class="col-sm-2 control-label">Giá mua ngay:</label>
        <div class="col-sm-3">
            <input type="number" class="form-control" name="Price" />
        </div>
        <label for="Price" class="col-sm-2 control-label">Giá khởi điểm:</label>
        <div class="col-sm-2">
            <input type="number" class="form-control" name="AucPrice" />
        </div>
    </div>
    
    <div class="form-group">
        <label for="TinyDes" class="col-sm-2 control-label">Mô tả sản phẩm:</label>
        <div class="col-sm-10">
            <input type="text" class="form-control" name="TinyDes" />
        </div>
    </div>
    <div class="form-group">
        <label for="FullDes" class="col-sm-2 control-label">Mô tả chi tiết:</label>
        <div class="col-sm-10">
            <textarea name="FullDes" id="FullDes"></textarea>
        </div>
    </div>

    <div class="form-group">
        <label for="StartTime" class="col-sm-2 control-label">Bắt đầu:</label>
        <div class="col-sm-4">
            <input type="text" class="form-control datepicker" id="time1"
                   name="StartTime" value="@DateTime.Now"/>
        </div>
        <script type="text/javascript">
            $(function () {
                $('#time1').datetimepicker({
                    format: 'DD/MM/YYYY hh:mm A'
                });
            });
        </script>
        <label for="EndTime" class="col-sm-2 control-label">Kết thúc:</label>
        <div class="col-sm-4">
            <input type="text" class="form-control datepicker" id="time2"
                   name="EndTime" value="@DateTime.Now.AddDays(7)"/>
        </div>
        <script type="text/javascript">
            $(function () {
                $('#time2').datetimepicker({
                    format: 'DD/MM/YYYY hh:mm A'
                });
            });
        </script>
    </div>
    <div class="form-group">
        <label for="StepPrice" class="col-sm-2 control-label">Bước tăng:</label>
        <div class="col-sm-10">
            <input type="number" class="form-control" name="StepPrice" />
        </div>
    </div>
    <div class="form-group">
        <div class="col-sm-10 col-sm-offset-2">
            <button type="submit" class="btn btn-danger" name="btnAdd">
                <i class="fa fa-check"></i> Thêm
            </button>
            <a href="@Url.Action("Index","Home")" class="btn btn-success">
                <i class="fa fa-reply"></i>Trở về trang chủ
            </a>
        </div>
    </div>
    <h1 style="text-align:center">@ViewBag.Message</h1>
</form>

@*<script src="assets/js/jquery-1.11.3.min.js"></script>

<script type="text/javascript">
			if('ontouchstart' in document.documentElement) document.write("<script src='assets/js/jquery.mobile.custom.min.js'>"+"<"+"/script>");
</script>
<script src="assets/js/bootstrap.min.js"></script>

<!-- page specific plugin scripts -->

  <script src="assets/js/excanvas.min.js"></script>

<script src="assets/js/jquery-ui.custom.min.js"></script>
<script src="assets/js/jquery.ui.touch-punch.min.js"></script>
<script src="assets/js/jquery.gritter.min.js"></script>
<script src="assets/js/bootbox.js"></script>
<script src="assets/js/jquery.easypiechart.min.js"></script>
<script src="assets/js/bootstrap-datepicker.min.js"></script>
<script src="assets/js/jquery.hotkeys.index.min.js"></script>
<script src="assets/js/bootstrap-wysiwyg.min.js"></script>
<script src="assets/js/select2.min.js"></script>
<script src="assets/js/spinbox.min.js"></script>
<script src="assets/js/bootstrap-editable.min.js"></script>
<script src="assets/js/ace-editable.min.js"></script>
<script src="assets/js/jquery.maskedinput.min.js"></script>

<!-- ace scripts -->
<script src="assets/js/ace-elements.min.js"></script>
<script src="assets/js/ace.min.js"></script>

<!-- inline scripts related to this page -->
<script type="text/javascript">
			jQuery(function($) {

				//editables on first profile page
				$.fn.editable.defaults.mode = 'inline';
				$.fn.editableform.loading = "<div class='editableform-loading'><i class='ace-icon fa fa-spinner fa-spin fa-2x light-blue'></i></div>";
			    $.fn.editableform.buttons = '<button type="submit" class="btn btn-info editable-submit"><i class="ace-icon fa fa-check"></i></button>'+
			                                '<button type="button" class="btn editable-cancel"><i class="ace-icon fa fa-times"></i></button>';



				var countries = [];
			    $.each({ "CA": "Canada", "IN": "India", "NL": "Netherlands", "TR": "Turkey", "US": "United States"}, function(k, v) {
			        countries.push({id: k, text: v});
			    });

				var currentValue = "NL";
			    $('#country').editable({
					type: 'select2',
					value : 'NL',
					//onblur:'ignore',
			        source: countries,
					select2: {
						'width': 140
					},
			    });
				try {

					try {
						document.createElement('IMG').appendChild(document.createElement('B'));
					} catch(e) {
						Image.prototype.appendChild = function(el){}
					}

					var last_gritter
					$('#avatar').editable({
						type: 'image',
						name: 'avatar',
						value: null,
						//onblur: 'ignore',  //don't reset or hide editable onblur?!
						image: {
							//specify ace file input plugin's options here
							btn_choose: 'Change Avatar',
							droppable: true,
							maxSize: 110000,//~100Kb

							//and a few extra ones here
							name: 'avatar',//put the field name here as well, will be used inside the custom plugin
							on_error : function(error_type) {//on_error function will be called when the selected file has a problem
								if(last_gritter) $.gritter.remove(last_gritter);
								if(error_type == 1) {//file format error
									last_gritter = $.gritter.add({
										title: 'File is not an image!',
										text: 'Please choose a jpg|gif|png image!',
										class_name: 'gritter-error gritter-center'
									});
								} else if(error_type == 2) {//file size rror
									last_gritter = $.gritter.add({
										title: 'File too big!',
										text: 'Image size should not exceed 100Kb!',
										class_name: 'gritter-error gritter-center'
									});
								}
								else {//other error
								}
							},
							on_success : function() {
								$.gritter.removeAll();
							}
						},
					    url: function(params) {
							// ***UPDATE AVATAR HERE*** //
							//for a working upload example you can replace the contents of this function with
							//examples/profile-avatar-update.js

							var deferred = new $.Deferred

							var value = $('#avatar').next().find('input[type=hidden]:eq(0)').val();
							if(!value || value.length == 0) {
								deferred.resolve();
								return deferred.promise();
							}


							//dummy upload
							setTimeout(function(){
								if("FileReader" in window) {
									//for browsers that have a thumbnail of selected image
									var thumb = $('#avatar').next().find('img').data('thumb');
									if(thumb) $('#avatar').get(0).src = thumb;
								}

								deferred.resolve({'status':'OK'});

								if(last_gritter) $.gritter.remove(last_gritter);
								last_gritter = $.gritter.add({
									title: 'Avatar Updated!',
									text: 'Uploading to server can be easily implemented. A working example is included with the template.',
									class_name: 'gritter-info gritter-center'
								});

							 } , parseInt(Math.random() * 800 + 800))

							return deferred.promise();

							// ***END OF UPDATE AVATAR HERE*** //
						},

						success: function(response, newValue) {
						}
					})
				}catch(e) {}

				
				//let's display edit mode by default?
				var blank_image = true;//somehow you determine if image is initially blank or not, or you just want to display file input at first
				if(blank_image) {
					$('#avatar').editable('show').on('hidden', function(e, reason) {
						if(reason == 'onblur') {
							$('#avatar').editable('show');
							return;
						}
						$('#avatar').off('hidden');
					})
				}
				

				//another option is using modals
				$('#avatar2').on('click', function(){
					var modal =
					'<div class="modal fade">\
					  <div class="modal-dialog">\
					   <div class="modal-content">\
						<div class="modal-header">\
							<button type="button" class="close" data-dismiss="modal">&times;</button>\
							<h4 class="blue">Change Avatar</h4>\
						</div>\
						\
						<form class="no-margin">\
						 <div class="modal-body">\
							<div class="space-4"></div>\
							<div style="width:75%;margin-left:12%;"><input type="file" name="file-input" /></div>\
						 </div>\
						\
						 <div class="modal-footer center">\
							<button type="submit" class="btn btn-sm btn-success"><i class="ace-icon fa fa-check"></i> Submit</button>\
							<button type="button" class="btn btn-sm" data-dismiss="modal"><i class="ace-icon fa fa-times"></i> Cancel</button>\
						 </div>\
						</form>\
					  </div>\
					 </div>\
					</div>';


					var modal = $(modal);
					modal.modal("show").on("hidden", function(){
						modal.remove();
					});

					var working = false;

					var form = modal.find('form:eq(0)');
					var file = form.find('input[type=file]').eq(0);
					file.ace_file_input({
						style:'well',
						btn_choose:'Click to choose new avatar',
						btn_change:null,
						no_icon:'ace-icon fa fa-picture-o',
						thumbnail:'small',
						before_remove: function() {
							//don't remove/reset files while being uploaded
							return !working;
						},
						allowExt: ['jpg', 'jpeg', 'png', 'gif'],
						allowMime: ['image/jpg', 'image/jpeg', 'image/png', 'image/gif']
					});

					form.on('submit', function(){
						if(!file.data('ace_input_files')) return false;

						file.ace_file_input('disable');
						form.find('button').attr('disabled', 'disabled');
						form.find('.modal-body').append("<div class='center'><i class='ace-icon fa fa-spinner fa-spin bigger-150 orange'></i></div>");

						var deferred = new $.Deferred;
						working = true;
						deferred.done(function() {
							form.find('button').removeAttr('disabled');
							form.find('input[type=file]').ace_file_input('enable');
							form.find('.modal-body > :last-child').remove();

							modal.modal("hide");

							var thumb = file.next().find('img').data('thumb');
							if(thumb) $('#avatar2').get(0).src = thumb;

							working = false;
						});


						setTimeout(function(){
							deferred.resolve();
						} , parseInt(Math.random() * 800 + 800));

						return false;
					});

				});
			});
</script>*@