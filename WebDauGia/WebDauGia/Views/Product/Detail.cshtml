@using WebDauGia.Models
@model Product
@{
    ViewBag.Title = "Chi tiết sản phẩm";
}
@section view_title{
    Chi tiết sản phẩm
}
@section css{
    <link href="~/assets/bootstrap-touchspin/jquery.bootstrap-touchspin.min.css" rel="stylesheet" />
    @*<link href="~/assets/css/style.css" rel="stylesheet" />*@
    <style type="text/css">
        .caption-lg-orange {
            font-weight: bold;
            font-size: 12pt;
            color: #fc6e04;
        }

        .caption-lg-red {
            font-weight: bold;
            font-size: 11pt;
            color: #f00;
        }

        .caption-lg-green {
            font-weight: bold;
            font-size: 11pt;
            color: #00FF00;
        }

        .padding {
            padding-top: 8px;
        }
    </style>
}

@section js{
    <script src="~/assets/bootstrap-touchspin/jquery.bootstrap-touchspin.min.js"></script>
    <script type="text/javascript">
        $('#txtQ').TouchSpin({
            min: 1,
            max: 50,
            verticalbuttons: true
        });
    </script>
}

@if (Model == null)
{
    <text>Sản phẩm không tồn tại!</text>
}
else
{
    <div class="row">
        <div class="col-md-12 caption-lg-orange">
            <div class="col-md-4">
                <img src="~/Images/sp/@Model.ProID/main.jpg" width="200" height="150" title="@Model.ProID"
                     onerror="this.onerror=null;this.src='/Images/sp/main.jpg';" />
            </div>
            <div class="col-md-4">
<<<<<<< HEAD
                <img src="~/Images/sp/@Model.ProID/main_thumbs_1.jpg" title="@Model.ProID"
                     onerror="this.onerror=null;this.src='/Images/sp/main.jpg';" />
            </div>
            <div class="col-md-4">
                <img src="~/Images/sp/@Model.ProID/main_thumbs_2.jpg" title="@Model.ProID"
=======
                <img src="~/Images/sp/@Model.ProID/main_thumbs_1.jpg" width="200" height="150" title="@Model.ProID"
                     onerror="this.onerror=null;this.src='/Images/sp/main.jpg';" />
            </div>
            <div class="col-md-4">
                <img src="~/Images/sp/@Model.ProID/main_thumbs_2.jpg" width="200" height="150" title="@Model.ProID"
>>>>>>> origin/master
                     onerror="this.onerror=null;this.src='/Images/sp/main.jpg';" />
            </div>
        </div>



        <div class="col-md-12 caption-lg-orange">
            <h2>@Model.ProName</h2>
        </div>
        <br />
        <hr width="100%" align="center" />

        <div class="col-md-12 padding">
            <span class="caption-lg-red">Giá hiện tại: @string.Format("{0:N0}", Model.AucPrice)</span>
        </div>
        <div class="col-md-12 padding">
            <span class="caption-lg-red">Giá mua ngay: @string.Format("{0:N0}", Model.Price)</span>
        </div>
        <div class="col-md-12 padding">
            <span class="caption-lg-red">Người bán: @string.Format("{0} [{1:0.00}/100 điểm]", WebDauGia.Helper.StringUtils.Replace(Model.Salesman), WebDauGia.Models.Function.GetReliability(Model.Salesman))</span>
        </div>
        @if (Model.Owner != null && Model.Owner != "")
        {
            <div class="col-md-12 padding">
                <span class="caption-lg-red">Người đang giữ giá cao nhất @string.Format("{0} điểm đánh giá: {1:0.00}/100", WebDauGia.Helper.StringUtils.Replace(Model.Owner), WebDauGia.Models.Function.GetReliability(Model.Owner))</span>
            </div>
        }
        else
        {
            <div class="col-md-12 padding">
                <span class="caption-lg-red">Người đang giữ giá cao nhất : chưa có </span>
            </div>
        }
        <div class="col-md-12 padding">
            <span class="caption-lg-red">Thời điểm đăng: @Model.StartTime</span>
        </div>
        <div class="col-md-12 padding">
            <span class="caption-lg-red">Thời điểm kết thúc: @Model.EndTime</span>
        </div>
        <div class="col-md-12 padding">
            <span class="caption-lg-red">Số lượng: @Model.Quantity</span>
        </div>
        @if (WebDauGia.Helper.CurrentContext.IsLogged() == true)
        {
            <form id="auction" action="/AuctionHistory/Add/" method="post" novalidate="novalidate">
                <div class="col-md-12 caption-lg-green">
                    <h3>
                        Bạn muốn ra giá:
                    </h3>
                    <input class="col-md-4 orm-control input-lg caption-lg-red" id="ragia" name="ragia" type="number">
                    @*@{

                            User us = (User)Session["user"];
                            AuctionHistory ah = new AuctionHistory();
                            ah.ProID = Model.ProID;
                            ah.UserName = us.UserName;
                            ah.Time = DateTime.Now;
                        }
                        @Html.Hidden("proid", @Model.ProID)
                        @Html.Hidden("uname", @us.UserName)
                        @Html.Hidden("time", @DateTime.Now)*@
                    @*<i>></i>@ah.ProID , @ah.UserName,@ah.Time*@
                    <button type="submit" class="btn btn-success orm-control input-lg" name="auction" id="auction">
                        Đấu giá
                    </button>
                </div>
            </form>
        }
        <br />
        <div class="col-md-12 padding">
            <div class="tabbable">
                <ul class="nav nav-tabs padding-18">
                    <li class="active">
                        <a data-toggle="tab" href="#thongtinsanpham">
                            <i class="green ace-icon fa fa-product-hunt bigger-120"></i>
                            Thông tin sản phẩm
                        </a>
                    </li>

                    <li>
                        <a data-toggle="tab" href="#lichsu">
                            <i class="orange ace-icon fa fa-history bigger-120"></i>
                            Lịch sử đấu giá sản phẩm
                        </a>
                    </li>

                    <li>
                        <a data-toggle="tab" href="#binhluan">
                            <i class="green ace-icon fa fa-comments bigger-120"></i>
                            Bình luận
                        </a>
                    </li>
                </ul>

                <div class="tab-content no-border padding-24">
                    <div id="thongtinsanpham" class="tab-pane in active">
                        <div class="row">
                            <div class="col-md-8 padding">
                                @Html.Raw(HttpUtility.HtmlDecode(Model.FullDes))
                            </div>
                        </div><!-- /.row -->

                    </div><!-- /#thongtinsanpham -->

                    <div id="lichsu" class="tab-pane">

                        <div class="tabbable">
                            <div class="tab-content profile-edit-tab-content">
                                <div id="edit-basic" class="tab-pane in active">
                                    <div class="col-md-8 padding">
                                        aii
                                    </div>
                                </div>

                            </div>
                        </div>


                    </div><!-- /#lichsu -->

                    <div id="binhluan" class="tab-pane">
                        <div class="tabbable">
                            <div class="tab-content profile-edit-tab-content">
                                <div id="edit-basic" class="tab-pane in active">
                                    <div class="col-md-12 padding">
                                        @{
                                            List<Comment> list;
                                            User user = (User)Session["user"];
                                            string Uname;
                                            using (var ctx = new QuanLyDauGiaEntities())
                                            {
                                                list = ctx.Comments.Where(bl => bl.ProID == Model.ProID).OrderByDescending(bl => bl.CmtID).ToList();
                                            }
                                            <div id="comments" class="clearfix">
                                                <span class="arr"></span>
                                                <a name="binhluan"></a>
                                                <h5 class="head-title-box" id="showNumberbinhluan">@list.Count() bình luận</h5>
                                                <ul class="comment-list unstyled clearfix" id="pn_list_comment" style="opacity: 1;">
                                                    @if (list.Count() == 0)
                                                    {
                                                        <li>
                                                            Chưa có bình luận nào, bạn hãy tham gia nhé !
                                                        </li>
                                                    }
                                                    else
                                                    {
                                                        foreach (var item in list)
                                                        {
                                                            <li>
                                                                <div class="comment-content">
                                                                    <div class="user-picture">
                                                                        <a href="../../SanPham/DSTheoThanhVien/@item.UserName" title=""><img src="../../images/avatardefault.png" width="50" height="50" border="0" alt="@item.UserName"></a>
                                                                    </div>
                                                                    <div class="meta-user-comment clearfix">
                                                                        <a href="../../SanPham/DSTheoThanhVien/@item.UserName" class="username">
                                                                            @{
                                                                                var ct = new QuanLyDauGiaEntities();
                                                                                var ten = ct.Users.Where(us => us.UserName == item.UserName).Single();
                                                                                Uname = ten.UserName;
                                                                            }
                                                                            @Uname
                                                                        </a>
                                                                        <small> - <time datetime="<%=item.NgayDang_BL %>"><span> @item.TimeCmt</span></time></small>
                                                                    </div>
                                                                    <div class="comment-body">@item.Comment1</div>
                                                                </div>
                                                            </li>
                                                                                    }
                                                                                }

                                                </ul>

                                                <h5 class="head-title-box">Gửi bình luận</h5>
                                                @if (Session["user"] == null)
                                                {
                                                    <div class="alert alert-success">
                                                        Bạn chưa đăng nhập !<br>Hãy <a href="@Url.Action("Login", "User")">đăng nhập</a> hoặc
                                                        <a href="@Url.Action("Register", "User")">đăng ký</a> để viết bình luận.
                                                    </div>
                                                }
                                                else
                                                {
                                                    //User s;
                                                    //using (var ctx = new QuanLyDauGiaEntities())
                                                    //{
                                                    //    s = ctx.Users.Where(us => us.UserName == Session["username"].ToString()).Single();
                                                    //}
                                                    //string us = Session["username"].ToString();

                                                    string us = user.UserName;
                                                    <ul class="comment-list form-comment unstyled clearfix">
                                                        <li>
                                                            <div class="comment-content">
                                                                <div class="user-picture">
                                                                    <a href="../../SanPham/DSTheoThanhVien/@us"><img src="../../images/avatardefault.png" width="50" height="50" border="0" alt="@us"></a>
                                                                </div>
                                                                <form id="comment" action="/Comment/Add/" method="post" novalidate="novalidate">
                                                                    @Html.Hidden("proid", @Model.ProID)
                                                                    @Html.Hidden("usname", us)

                                                                    <textarea id="noidung" class="col-md-12 required" name="noidung"></textarea>
                                                                    <div class="controls">
                                                                        <input type="submit" name="comment" id="comment">
                                                                        <input name="action" type="hidden" value="comment">

                                                                    </div>
                                                                </form>
                                                            </div>
                                                        </li>
                                                    </ul>
                                                }
                                            </div>
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div><!-- /#binhluan -->
                </div>
            </div>
        </div>
    </div>

    @*if (CurrentContext.IsLogged())
                {
                    <form class="form-horizontal" id="frmAddItem" method="post" action="@Url.Action("Add","Cart")">
                        <div class="form-group">
                            <div class="col-sm-4">
                                <input type="hidden" id="txtP" name="proId" value="@Model.ProID" />
                                <div class="input-group" style="margin-left: 24px;">
                                    <input id="txtQ" type="text" name="quantity" class="form-control" placeholder="Slg" value="1" />
                                    <span class="input-group-btn">
                                        <button class="btn btn-primary" type="submit">
                                            <i class="fa fa-cart-plus"></i>
                                        </button>
                                    </span>
        <<<<<<< HEAD
                                </div>
                            </div>
                        </div>
                    </form>
                }*@
}

<<<<<<< HEAD
=======
@{
    List<Comment> list;
    User user = (User)Session["user"];
    string Uname;
    using (var ctx = new QuanLyDauGiaEntities())
    {
        list = ctx.Comments.Where(bl => bl.ProID == Model.ProID).OrderByDescending(bl => bl.CmtID).ToList();
    }
    <div id="comments" class="clearfix">
        <span class="arr"></span>
        <a name="binhluan"></a>
        <h5 class="head-title-box" id="showNumberbinhluan">@list.Count() bình luận</h5>
        <ul class="comment-list unstyled clearfix" id="pn_list_comment" style="opacity: 1;">

            @if (list.Count() == 0)
            {
            <li>
                Chưa có bình luận nào, bạn hãy tham gia nhé !
            </li>
            }
            else
            {
                foreach (var item in list)
                {
            <li>
                <div class="comment-content">
                    <div class="user-picture">
                        <a href="../../SanPham/DSTheoThanhVien/@item.UserName" title="">
                            <img src="../../images/avatardefault.png" width="50" height="50" border="0" alt="@item.UserName"
                                 >
                        </a>
                    </div>
                    <div class="meta-user-comment clearfix">
                        <a href="../../SanPham/DSTheoThanhVien/@item.UserName" class="username">

                            @{
                                var ct = new QuanLyDauGiaEntities();
                                var ten = ct.Users.Where(us => us.UserName == item.UserName).Single();
                                Uname = ten.UserName;
                            }
                            @Uname
                        </a>
                        <small> - <time datetime="<%=item.NgayDang_BL %>"><span> @item.TimeCmt</span></time></small>
                    </div>
                    <div class="comment-body">@item.Comment1</div>

                </div>
            </li>

                                            }
                                        }
        </ul>

        <h5 class="head-title-box">Gửi bình luận</h5>
        @if (Session["user"] == null)
        {
            <div class="alert alert-success">
                Bạn chưa đăng nhập !<br>Hãy <a href="@Url.Action("Login", "User")">đăng nhập</a> hoặc
                <a href="@Url.Action("Register", "User")">đăng ký</a> để viết bình luận.
            </div>
        }
        else
        {
            //User s;
            //using (var ctx = new QuanLyDauGiaEntities())
            //{
            //    s = ctx.Users.Where(us => us.UserName == Session["username"].ToString()).Single();
            //}
            //string us = Session["username"].ToString();
            
            string us = user.UserName;
            <ul class="comment-list form-comment unstyled clearfix">
                <li>
                    <div class="comment-content">
                        <div class="user-picture">
                            <a href="../../SanPham/DSTheoThanhVien/@us">
                                <img src="../../images/avatardefault.png" width="50" height="50" border="0" alt="@us"
                                     onerror="this.onerror = null; this.src = '/assets/images/avatardefault.png';"/>
                            </a>
                        </div>
                        <form id="comment" action="/Comment/Add/" method="post" novalidate="novalidate">
                            @Html.Hidden("proid", @Model.ProID)
                            @Html.Hidden("usname", us)
>>>>>>> origin/master


